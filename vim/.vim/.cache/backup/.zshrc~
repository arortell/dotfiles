# If you come from bash you might have to change your $PATH.
# REMOVE PYENV
export PATH="$HOME/bin:$PATH"

# Fix for home and end keys
bindkey "${terminfo[khome]}" beginning-of-line
bindkey "${terminfo[kend]}" end-of-line
bindkey '^[[1~' beginning-of-line
bindkey '^[[4~' end-of-line'

# disable multibyte
unsetopt MULTIBYTE

# Path to your oh-my-zsh installation.
export ZSH=$HOME/.oh-my-zsh

# Java Bullshit
export JAVA_HOME="/usr/lib/jvm/java-10-openjdk"
export _JAVA_OPTIONS="-Dsun.awt.disablegrab=true -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true -Dswing.defaultlaf=com.sun.java.swing.plaf.gtk.GTKLookAndFeel -Dswing.crossplatformlaf=com.sun.java.swing.plaf.gtk.GTKLookAndFeel"
export _SILENT_JAVA_OPTIONS="$_JAVA_OPTIONS"
unset _JAVA_OPTIONS
alias java='java "$_SILENT_JAVA_OPTIONS"'

# auto cd 'Just type dir name'
setopt autocd
cdpath+=(~)

# Set name of the theme to load. Optionally, if you set this to "random"
# it'll load a random theme each time that oh-my-zsh is loaded.
# See https://github.com/robbyrussell/oh-my-zsh/wiki/Themes
#ZSH_THEME="spaceship"
ZSH_THEME="xiong-chiamiov-plus"
#ZSH_THEME="cloud"

# # Bateria
POWERLEVEL9K_BATTERY_CHARGING='yellow'
POWERLEVEL9K_BATTERY_CHARGED='blue'
POWERLEVEL9K_BATTERY_LOW_THRESHOLD='20'
POWERLEVEL9K_BATTERY_LOW_COLOR='red'
POWERLEVEL9K_BATTERY_CHARGED_BACKGROUND='46'
POWERLEVEL9K_BATTERY_CHARGED_FOREGROUND='235'
POWERLEVEL9K_BATTERY_CHARGING_BACKGROUND='178'
POWERLEVEL9K_BATTERY_CHARGING_FOREGROUND='235'
POWERLEVEL9K_BATTERY_LOW_BACKGROUND='88'
POWERLEVEL9K_BATTERY_LOW_FOREGROUND='235'
POWERLEVEL9K_BATTERY_CHARGED_ICON='/UF240'
POWERLEVEL9K_BATTERY_LOW_ICON='/UF240'
POWERLEVEL9K_BATTERY_CHARGING_ICON='/UF1E6'
POWERLEVEL9K_BATTERY_DISCONNECTED_FOREGROUND='195'
POWERLEVEL9K_BATTERY_DISCONNECTED_BACKGROUND='009'
POWERLEVEL9K_BATTERY_ICON='\UF1E6'


#POWERLEVEL9K_STATUS_OK_IN_NON_VERBOSE=true
#POWERLEVEL9K_STATUS_VERBOSE=false
#POWERLEVEL9K_COMMAND_EXECUTION_TIME_BACKGROUND='black'
#POWERLEVEL9K_COMMAND_EXECUTION_TIME_FOREGROUND='blue'

#POWERLEVEL9K_MULTILINE_FIRST_PROMPT_PREFIX="%F{blue}\u256D\u2500%f"
#POWERLEVEL9K_MULTILINE_LAST_PROMPT_PREFIX="%F{blue}\u2570\uf460%f "

POWERLEVEL9K_MODE='nerdfont-complete'
#POWERLEVEL9K_MODE='awesome-patched'
POWERLEVEL9K_PROMPT_ON_NEWLINE=true
#POWERLEVEL9K_MULTILINE_FIRST_PROMPT_PREFIX="%{%F{249}%}\u250f"
#POWERLEVEL9K_MULTILINE_LAST_PROMPT_PREFIX="%{%F{249}%}\u2517%{%F{default}%} "
POWERLEVEL9K_MULTILINE_FIRST_PROMPT_PREFIX="↱"
POWERLEVEL9K_MULTILINE_LAST_PROMPT_PREFIX="↳ " 
#POWERLEVEL9K_SHORTEN_DIR_LENGTH=4
POWERLEVEL9K_SHORTEN_STRATEGY="truncate_middle"
POWERLEVEL9K_OS_ICON_BACKGROUND="black"
POWERLEVEL9K_OS_ICON_FOREGROUND="249"
POWERLEVEL9K_TODO_BACKGROUND="black"
POWERLEVEL9K_TODO_FOREGROUND="249"
POWERLEVEL9K_DIR_HOME_BACKGROUND="black"
POWERLEVEL9K_DIR_HOME_FOREGROUND="249"
POWERLEVEL9K_DIR_HOME_SUBFOLDER_BACKGROUND="black"
POWERLEVEL9K_DIR_HOME_SUBFOLDER_FOREGROUND="249"
POWERLEVEL9K_DIR_DEFAULT_BACKGROUND="black"
POWERLEVEL9K_DIR_DEFAULT_FOREGROUND="249"
POWERLEVEL9K_STATUS_OK_BACKGROUND="black"
POWERLEVEL9K_STATUS_OK_FOREGROUND="green"
POWERLEVEL9K_STATUS_ERROR_BACKGROUND="black"
POWERLEVEL9K_STATUS_ERROR_FOREGROUND="red"
POWERLEVEL9K_LOAD_CRITICAL_BACKGROUND="black"
POWERLEVEL9K_LOAD_WARNING_BACKGROUND="black"
POWERLEVEL9K_LOAD_NORMAL_BACKGROUND="black"
POWERLEVEL9K_LOAD_CRITICAL_FOREGROUND="249"
POWERLEVEL9K_LOAD_WARNING_FOREGROUND="249"
POWERLEVEL9K_LOAD_NORMAL_FOREGROUND="249"
POWERLEVEL9K_LOAD_CRITICAL_VISUAL_IDENTIFIER_COLOR="red"
POWERLEVEL9K_LOAD_WARNING_VISUAL_IDENTIFIER_COLOR="yellow"
POWERLEVEL9K_LOAD_NORMAL_VISUAL_IDENTIFIER_COLOR="green"
POWERLEVEL9K_RAM_BACKGROUND="black"
POWERLEVEL9K_RAM_FOREGROUND="249"
POWERLEVEL9K_RAM_ELEMENTS=(ram_free)
#POWERLEVEL9K_BATTERY_LOW_BACKGROUND="black"
#POWERLEVEL9K_BATTERY_CHARGING_BACKGROUND="black"
#POWERLEVEL9K_BATTERY_CHARGED_BACKGROUND="black"
#POWERLEVEL9K_BATTERY_DISCONNECTED_BACKGROUND="black"
#POWERLEVEL9K_BATTERY_LOW_FOREGROUND="249"
#POWERLEVEL9K_BATTERY_CHARGING_FOREGROUND="249"
#POWERLEVEL9K_BATTERY_CHARGED_FOREGROUND="249"
#POWERLEVEL9K_BATTERY_DISCONNECTED_FOREGROUND="249"
#POWERLEVEL9K_BATTERY_LOW_VISUAL_IDENTIFIER_COLOR="red"
#POWERLEVEL9K_BATTERY_CHARGING_VISUAL_IDENTIFIER_COLOR="yellow"
#POWERLEVEL9K_BATTERY_CHARGED_VISUAL_IDENTIFIER_COLOR="green"
#POWERLEVEL9K_BATTERY_DISCONNECTED_VISUAL_IDENTIFIER_COLOR="249"
#POWERLEVEL9K_TIME_BACKGROUND="black"
#POWERLEVEL9K_TIME_FOREGROUND="249"
#POWERLEVEL9K_TIME_FORMAT="%D{%H:%M:%S} \UE12E"

#POWERLEVEL9K_OS_ICON_BACKGROUND='black'
#POWERLEVEL9K_LINUX_ICON='%F{cyan} \uf303 %F{white} arch %F{cyan}linux%f'

POWERLEVEL9K_LEFT_PROMPT_ELEMENTS=('status' 'todo' 'dir' 'vcs' 'dir_writable')
POWERLEVEL9K_RIGHT_PROMPT_ELEMENTS=('background_jobs' 'load' 'ram_joined' 'public_ip' 'battery')



#POWERLEVEL9K_BATTERY_STAGES="▁▂▃▄▅▆▇█"

#POWERLEVEL9K_BATTERY_STAGES=(
#   $'▏    ▏' $'▎    ▏' $'▍    ▏' $'▌    ▏' $'▋    ▏' $'▊    ▏' $'▉    ▏' $'█    ▏'
#   $'█▏   ▏' $'█▎   ▏' $'█▍   ▏' $'█▌   ▏' $'█▋   ▏' $'█▊   ▏' $'█▉   ▏' $'██   ▏'
#   $'██   ▏' $'██▎  ▏' $'██▍  ▏' $'██▌  ▏' $'██▋  ▏' $'██▊  ▏' $'██▉  ▏' $'███  ▏'
#   $'███  ▏' $'███▎ ▏' $'███▍ ▏' $'███▌ ▏' $'███▋ ▏' $'███▊ ▏' $'███▉ ▏' $'████ ▏'
#   $'████ ▏' $'████▎▏' $'████▍▏' $'████▌▏' $'████▋▏' $'████▊▏' $'████▉▏' $'█████▏' )

#POWERLEVEL9K_LEFT_PROMPT_ELEMENTS=(vcs os_icon dir ram dir_writable)
#POWERLEVEL9K_RIGHT_PROMPT_ELEMENTS=(root_indicator background_jobs status load)


#POWERLEVEL9K_USER_ICON="\uF415" # 
#POWERLEVEL9K_ROOT_ICON="#"
#POWERLEVEL9K_SUDO_ICON=$'\uF09C' # 


#ZSH_THEME="powerlevel9k/powerlevel9k"
#ZSH_THEME="xiong-chiamiov-plus"

# ORDER
#SPACESHIP_PROMPT_ORDER=(
#  time
#  user
#  host
#  dir
#  git
#  hg
#  package
#  node
#  ruby
#  elixir
#  xcode
#  swift
#  golang
#  php
#  rust
#  julia
#  docker
#  aws
#  venv
#  conda
#  pyenv
#  dotnet
#  ember
#  kubecontext
#  battery
#  exec_time
#  line_sep
#  vi_mode
#  jobs
#  exit_code
#  char
#)



# Uncomment the following line to use case-sensitive completion.
# CASE_SENSITIVE="true"

# Uncomment the following line to use hyphen-insensitive completion. Case
# sensitive completion must be off. _ and - will be interchangeable.
 HYPHEN_INSENSITIVE="true"

# Uncomment the following line to disable bi-weekly auto-update checks.
# DISABLE_AUTO_UPDATE="true"

# Uncomment the following line to change how often to auto-update (in days).
# export UPDATE_ZSH_DAYS=13

# Uncomment the following line to disable colors in ls.
# DISABLE_LS_COLORS="true"

# Uncomment the following line to disable auto-setting terminal title.
# DISABLE_AUTO_TITLE="true"

# Uncomment the following line to enable command auto-correction.
 ENABLE_CORRECTION="true"

# Uncomment the following line to display red dots whilst waiting for completion.
 COMPLETION_WAITING_DOTS="true"

# Uncomment the following line if you want to disable marking untracked files
# under VCS as dirty. This makes repository status check for large repositories
# much, much faster.
# DISABLE_UNTRACKED_FILES_DIRTY="true"

# Uncomment the following line if you want to change the command execution time
# stamp shown in the history command output.
# The optional three formats: "mm/dd/yyyy"|"dd.mm.yyyy"|"yyyy-mm-dd"
# HIST_STAMPS="mm/dd/yyyy"

# Would you like to use another custom folder than $ZSH/custom?
# ZSH_CUSTOM=/path/to/new-custom-folder

# Which plugins would you like to load? (plugins can be found in ~/.oh-my-zsh/plugins/*)
# Custom plugins may be added to ~/.oh-my-zsh/custom/plugins/
# Example format: plugins=(rails git textmate ruby lighthouse)
# Add wisely, as too many plugins slow down shell startup.
plugins=(git colorize colored-man-pages_mod compleat copyfile copydir cp dircycle dirhistory dirpersist history history-substring-search systemd systemadmin pass zsh-syntax-highlighting python github git-prompt nmap pip zsh-autosuggestions zsh-completions zsh-history-substring-search zsh-reload zsh-navigation-tools archlinux bspwm rsync sudo safe-paste battery fasd zshmarks aurtab cp)

source $ZSH/oh-my-zsh.sh

autoload -Uz compinit compinit promptinit run-help
alias help=run-help
compinit
promptinit
zstyle ':completion:*' menu select
autoload -Uz run-help-git
autoload -Uz run-help-ip
autoload -Uz run-help-openssl
autoload -Uz run-help-p4
autoload -Uz run-help-sudo
autoload -Uz run-help-svk
autoload -Uz run-help-svn

# User configuration
export MANPATH="/usr/local/man:/usr/share/man"

# You may need to manually set your language environment
# export LANG=en_US.UTF-8

# Preferred editor for local and remote sessions
if [[ -n $SSH_CONNECTION ]]; then
   export EDITOR='vim'
else
   export EDITOR='vim'
 fi

# Bash compatibily
function bashsource(){
  if [ -z $1 ]; then
    echo "bashsource FILE"
    return 1
  fi
  export BASH_SOURCE=$(dirname $1)
  source $1
}


### Get number of jobs
function precmd {
	psvar[2]=$#jobstates; [[ $psvar[2] -eq 0 ]] && psvar[2]=()
}

zmodload zsh/parameter

# Compilation flags
export ARCHFLAGS="-arch x86_64"

# ssh
export SSH_KEY_PATH="~/.ssh/rsa_id"

# Pass
export PASSWORD_STORE_X_SELECTION=primary

#colors
#export Black        0;30
#export Dark Gray    1;30
#export Dark Red     0;31
#export Light Red    1;31
#export Dark Green   0;32
#export Light Green  1;32
#export Dark Yellow  0;33
#export Light Yellow 1;33
#export Dark Blue    0;34
#export Light Blue   1;34
#export Dark Purple  0;35
#export Light Purple 1;35
#export Dark Cyan    0;36
#export Light Cyan   1;36
#export Light Gray   0;37
#export White        1;37

# Colors
ESC_SEQ="\x1b["
RESET=$ESC_SEQ"39;49;00m"
RED=$ESC_SEQ"31;01m"
GREEN=$ESC_SEQ"32;01m"
YELLOW=$ESC_SEQ"33;01m"
BLUE=$ESC_SEQ"34;01m"
MAGENTA=$ESC_SEQ"35;01m"
CYAN=$ESC_SEQ"36;01m"


# prevent file from being overwritten with > 
# can be overcome with >|
#set -o noclobber

# enable extened globs
setopt extendedglob

# Set personal aliases, overriding those provided by oh-my-zsh libs,
# plugins, and themes. Aliases can be placed here, though oh-my-zsh
# users are encouraged to define aliases within the ZSH_CUSTOM folder.
# For a full list of active aliases, run `alias`.
unalias h
  
alias count='ls -1 | wc -l'
alias l="clear && ls $@"
alias ll="clear && ls -lh"
alias la="clear && ls -a $@"
alias c="pycp -g $@"
alias la="clear && ls -a $@"
alias c="pycp $@"
alias cy="pv $1 > $2"
alias cp="acp -g $@"
alias vcp="vcp -vp $@"
alias du='cdu -sidh'
alias m='pymv -g $@'
alias mv='amv -g $@'
alias m='pymv $@'
alias define="/usr/bin/sdcv"
alias def="/usr/bin/sdcv"
alias del="trash-put $@"
alias delete="trash-put $@"
alias df='dfc -p /dev/'
alias sa='sudoedit $1'
alias cfg-zsh='$EDITOR ~/.zshrc'
alias cfg-qute='$EDITOR ~/.config/qutebrowser/config.py'
alias cfg-poly='$EDITOR ~/.config/polybar/config'
alias cfg-sxhkd='$EDITOR ~/.config/sxhkd/sxhkdrc'
alias cfg-bspwm='$EDITOR ~/.config/bspwm/bspwmrc'
alias cfg-herb='$EDITOR ~/.config/herbstluftwm/autostart'
alias cfg-profile='sa /etc/profile'
alias rld-zsh='source ~/.zshrc'
alias rld-profile='source /etc/profile'
alias free='free -h'
alias vdir='vdir --color=auto'
alias clr='clear && ls'
alias lock='sudo passwd -l $1'
alias unlock='sudo passwd -u $1'
alias spell='aspell -a $@'
alias update="pac"
alias rcp='rsync -aP'
alias rmv='rsync -aP --remove-source-files'
alias restore='trash-restore'
alias h='function hdi(){ howdoi $* -c -n 5; }; hdi'
alias hc="herbstclient"

todo
################# Functions ######################

# List network stats
m-ip() {
  echo "--------------- Network Information ---------------"
  echo "router ip:" $(netstat -rn | awk 'FNR == 3 {print $2}')
  # newer system like archlinux
  ip addr | awk '/global/ {print $1,$2}' | cut -d\/ -f1
  ip addr | awk '/global/ {print $3,$4}'
  ip addr | awk '/ether/ {print $1,$2}'
  ip addr | awk '/scope link/ {print $1,$2}' | cut -d\/ -f1
  echo "External IP: $(dig +short myip.opendns.com @resolver1.opendns.com)"
  echo "---------------------------------------------------"
}

# list everything connected to network with nmap
m-connected() {
  echo "--------------- Connected Devices -----------------"
    nmap -sn $(netstat -rn | awk 'FNR == 3 {print $2}')/24
  echo "---------------------------------------------------"
}

# list everything connected to network
m-devices() {
  echo "---------------- Connected Devices ---------------"
  sudo arp-scan --interface=wlan0 --localnet

}

# Kill all zombie process
killall-zombies() { 
  kill -HUP $(ps -A -ostat,ppid | grep -e '[zZ]'| awk '{ print $2 }') ;
}

# create backup copy
cpbak() { 
  cp $1{,.bak} ;
}

# Duh read the function name
update-grub() {
  sudo grub-mkconfig -o /boot/grub/grub.cfg ;
}


# ls recent items at bottom with green TODAY yellow YESTERDAY substituted with file permission also
lst() {
  ls -vAFq --color=yes -got --si --time-style=long-iso "$@" \
  | sed "s/$(date +%Y-%m-%d)/\x1b[32m     TODAY\x1b[m/;s/$(date +'%Y-%m-%d' -d yesterday)/\x1b[33m YESTERDAY\x1b[m/" \
  | awk '{k=0;for(i=0;i<=8;i++)k+=((substr($1,i+2,1)~/[rwx]/)*2^(8-i));if(k)printf(" %0o ",k);print}' | tac
}

# make and cd to "$1" directory
function mcd ()
{
   mkdir -p "$1"; cd "$1";
}

# rember dirs for dirs -v
DIRSTACKFILE="$HOME/.cache/zsh/dirs"
if [[ -f $DIRSTACKFILE ]] && [[ $#dirstack -eq 0 ]]; then
  dirstack=( ${(f)"$(< $DIRSTACKFILE)"} )
  [[ -d $dirstack[1] ]] && cd $dirstack[1]
fi

DIRSTACKSIZE=20

setopt AUTO_PUSHD PUSHD_SILENT PUSHD_TO_HOME

## Remove duplicate entries
setopt PUSHD_IGNORE_DUPS

## This reverts the +/- operators.
setopt PUSHD_MINUS

# rehas automaticly
zstyle ':completion:*' rehash true

# file manager keybindings
cdUndoKey() {
  popd      > /dev/null
  zle       reset-prompt
  echo
  ls
  echo
}

cdParentKey() {
  pushd .. > /dev/null
  zle      reset-prompt
  echo
  ls
  echo
}

zle -N                 cdParentKey
zle -N                 cdUndoKey
bindkey '^[[1;3A'      cdParentKey
bindkey '^[[1;3D'      cdUndoKey

# history search
autoload -Uz up-line-or-beginning-search down-line-or-beginning-search
zle -N up-line-or-beginning-search
zle -N down-line-or-beginning-search

[[ -n "$key[Up]"   ]] && bindkey -- "$key[Up]"   up-line-or-beginning-search
[[ -n "$key[Down]" ]] && bindkey -- "$key[Down]" down-line-or-beginning-search

# arrow driven completions
zstyle ':completion:*' menu select
setopt COMPLETE_ALIASES

# entered completion colorize
zstyle -e ':completion:*:default' list-colors 'reply=("${PREFIX:+=(#bi)($PREFIX:t)(?)*==34=34}:${(s.:.)LS_COLORS}")';

# rvm ruby virtualenv
[[ -s "$HOME/.rvm/scripts/rvm" ]] && source "$HOME/.rvm/scripts/rvm"

#### THIS NEEDS TO BE UNCOMMENTED FOR SPACESHIOP TO WORK
#source "/home/b14ckr41n/.oh-my-zsh/custom/themes/spaceship.zsh-theme"


# syntax highlight source ######################### MUST BE LAST LINE IN FILE ###################
source ~/.oh-my-zsh/custom/plugins/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
