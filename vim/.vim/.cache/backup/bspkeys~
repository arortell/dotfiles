#!/usr/bin/env bash

#################### wm independent hotkeys

# terminal emulator
super + Return
	terminology

# My Menu
super + space
  adams_menu

# Window Switcher
super + shift + space 
  rofi -show

######################## bspwm hotkeys

# make sxhkd reload its configuration files:
super + Escape
	pkill -USR1 -x sxhkd; \
  twmnc "Sxhkd Configuration Reloaded"

# refresh or quit bspwm
super + shift + {_,alt + }Escape
	{pkill -x panel; bspc wm -d > "$BSPWM_STATE" && bspc quit; twmnc "Bspwm Reloaded", \
	 pkill -x panel; bspc quit 1}

# Adjust gaps on the fly
super + {minus,equal}
 bspc config --desktop focused window_gap $((`bspc config --desktop focused window_gap` {+,-} 2 ))

# close and kill
super + Delete
	bspc node --kill

# if the current node is automatic, send it to the last manual, otherwise pull the last leaf
super + y
	bspc query --nodes --node focused.automatic && bspc node --node last.!automatic || bspc node last.leaf --node focused

# swap the current node and the biggest node
super + g
	bspc node --swap biggest

############################ state/flags

# alternate between the tiled and monocle layout
super + ctrl + m
	bspc desktop --layout next

# set the window state
super + {t,shift + f,f}
	bspc node --state {tiled,floating,fullscreen}

# set the node flags
super + ctrl + {x,y,z}
	bspc node --flag {locked,sticky,private}


############################## focus/swap


# focus the node in the given direction
super + {_,shift + }{Left,Down,Up,Right}
	bspc node --{focus,swap} {west,south,north,east}

# focus the next/previous node
super + {_,shift + }c
	bspc node --focus {next,prev}

# focus the next/previous desktop
super + bracket{left,right}
	bspc desktop --focus {prev,next}

# focus the last node/desktop
super + {grave,Tab}
	bspc {node,desktop} --focus last

# focus the older or newer node in the focus history
super + {o,i}
	bspc wm --record-history off; \
	bspc node {older,newer} --focus; \
	bspc wm --record-history on

# focus or send to the given desktop
super + {_,shift + }{1-9,0}
	bspc {desktop --focus,node --to-desktop} '^{1-9,10}'

# focus or send window/node to monitor
super + {_,shift + } {m,comma,period,slash}
  bspc {monitor --focus,node --to-monitor} {TV,Left,Center,Right}

# Swap desktops
super + alt + {1-9,0}
  bspc desktop focused --swap '^{1-9,0}'

############################################ preselect

# preselect the direction
super + ctrl + {Left,Down,Up,Right}
	bspc node --presel-dir {west,south,north,east}

# preselect the ratio
super + ctrl + {1-9}
	bspc node --presel-ratio 0.{1-9}

# cancel the preselection for the focused node
super + ctrl + space
	bspc node --presel-dir cancel

# cancel the preselection for the focused desktop
super + ctrl + shift + space
	bspc query --nodes --desktop | xargs -I id --node 1 bspc node id --presel-dir cancel

# resize windows
super + alt + {Left,Down,Up,Right}
   ~/bin/bspwm_resize.sh {west,south,north,east}


###################################################### Media Keys

# Raise/Lower Sound 
XF86Audio{Lower,Raise}Volume
 amixer set Master 2%{-,+} && twmnc $(alsavol -d)

# Mute  
XF86AudioMute
  amixer set Master toggle && twmnc $(alsavol -d)

# Screenshot
Print
	scrot -s && twmnc "ScreenShot Taken"



##################################################### Applications
super + shift + Return
  luakit 

super + l
  slock

super + q
  qtcreator

super + w
  wing6.0

super + b
  tor-browser

####################################################### Scratchpads
F1
   xdotool search --onlyvisible --classname _scratch windowunmap \
      || xdotool search --classname _scratch windowmap \
      || terminology --name=_scratch --title=_scratch --geometry=197x53


F12
   xdotool search --onlyvisible --classname _htop windowunmap \
      || xdotool search --classname _htop windowmap \
      || terminology --name=_htop --title=_htop --geometry=197x53

super + F5
    id=$(bspc query -N -n "focused");\
    if [ -n "$id" ];then \
        xprop -id $id -f _SCRATCH 32ii -set _SCRATCH $(date +%s,%N);\
        bspc node -t "floating";\
        xdotool windowunmap $id;\
    fi

F5
    i=$(bspc query -N -n "focused.floating");\
    if [ -n "$i" ];then \
        xprop -id $i -f _SCRATCH 32ii -set _SCRATCH $(date +%s,%N);\
        xdotool windowunmap $i;\
    else;\
        i=$(for w in $(xwininfo -root -children | grep -e "^\s*0x[0-9a-f]\+" -o);do \
            t=$(xprop -id $w _SCRATCH | grep ' = \(.*\)');\
            if [ -n "$t" ];then \
                echo $t $w;\
            fi;\
        done|sort -n|head -n1|cut -d" " -f 5);\
        if [ -n "$i" ];then \
            xprop -id $i -remove _SCRATCH;\
            bspc rule -a \* state=floating center=on --one-shot;\
            xdotool windowmap $i;\
            bspc node -f $i;\
        fi;\
    fi

